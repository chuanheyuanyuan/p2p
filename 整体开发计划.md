# 整体开发计划

> 版本：2025-02-21 · 负责人：前端 Tech Lead（Codex）  
> 范围：P2P 放贷平台（借款端 + Admin + BFF + 微服务）全局路线图

## 1. 北极星目标与成功指标

- **12 个月目标**：交付可运营、可扩展的现金贷平台，串起注册→授信→申请→放/还款→催收→复借闭环，并为二期资金撮合做准备。
- **MVP 后 90 天指标**
  - 注册→申请 ≥ 35%，申请→放款 ≥ 20%
  - 放款后首逾率（D0）≤ 40%，回调幂等错误 ≤ 0.1%
  - 核心链路 P95 ≤ 200ms，放/还款可用性 ≥ 99.9%
  - “平台每日统计/逾期迁移率/渠道统计/复借率”四张主报上线

## 2. 里程碑节奏（每 Sprint 2 周）

| Sprint | 主题 | 关键产出 |
| --- | --- | --- |
| Sprint 0 | 基础设施 | 仓库骨架、环境模板、健康检查 |
| Sprint 1 | 登录 & 设备档案 | auth-svc OTP/JWT、user-svc 设备 |
| Sprint 2 | KYC & 风控 | user-svc KYC、risk-svc 规则 |
| Sprint 3 | 申请/审批 | loan-svc 草稿/提交、合同 stub |
| Sprint 4 | 放款 & 台账 | payment-svc 放款、ledger-svc 分录 |
| Sprint 5 | 账单/还款/通知 | payment-svc 还款、loan-svc schedule、notify-svc |
| Sprint 6 | 催收 & 指标 | collection-svc、report-svc 日报 |
| Sprint 7 | 渠道 & 运营配置 | channel-svc、ops-svc、App 升级 |
| Sprint 8 | 性能 & 上线准备 | 观测、告警、复借策略 |
| Phase 2 | 资金撮合 | p2p-svc、出借人账户/报表 |

## 3. 服务交付清单（T1~T20）

- **认证/用户域**：auth-svc (OTP/JWT)、user-svc (设备/KYC)、联系人/授权、BFF-Mobile 聚合。
- **贷款/资金域**：loan-svc（产品、申请、合同、账单）、payment-svc（放/还款、回调）、ledger-svc（双分录）。
- **风控与通知**：risk-svc（规则），notify-svc（模板触达）。
- **催收与数据**：collection-svc（建案/分案/工作台）、report-svc（日指标、催收 aging）、channel-svc（归因与漏斗）。
- **前端与 BFF**：
  - BFF-Mobile / BFF-Admin：FastAPI 聚合层，封装 borrower/admin API。
  - Admin Web（T19）：Vite + React + AntD，现已完成 M1/M2（登录/RBAC、Dashboard & Daily Stats）。
  - 借款人 Web / App（后续）：Next.js SPA 或 Flutter（根据蓝图）。
- **后续扩展**：ops-svc（运营配置）、p2p-svc（资金方）、observability（日志/追踪）。

## 4. 前端路线（Admin Web 为例）

1. **M1 登录与 RBAC（✅ 已交付）**
   - /login 页面、Zustand Auth Store、React Query Provider。
   - 菜单/路由按角色过滤（super_admin、审批员、催收、运营、渠道、分析等）。
2. **M2 首页看板/日报（✅ 已交付）**
   - Dashboard：接入 `/admin/v1/dashboard`（mock fallback），KPI/逾期/催回/今日指标/转化率组件化并加入错误提示。
   - Daily Stats：React Query + 导出任务（`/admin/v1/reports/daily/export`）、指标汇总、筛选项与说明文案。
3. **M3 申请列表/导出 & 审批详情**
   - 与 bff-admin `/admin/v1/applications` 契约对齐，支持导出任务。
4. **M4 借款人档案 & 审批四 Tab**
   - 聚合 user/risk/loan 数据，支持 OCR 回写、合同下载。
5. **M5 财务放/还款对账**
   - payment/ledger 视图、失败重试、差异清单导出。
6. **M6 催收九模块**
   - 案件池、工作台、PTP、外呼记录、绩效。
7. **M7 运营配置 & App 升级**
   - ops-svc/notify-svc/channel-svc 配置页面，记录审计日志。
8. **M8 报表中心**
   - 平台统计、逾期迁移率、渠道漏斗、复借率等。

> 每个功能点需：独立 feature 分支 + worktree、通过 ESLint/Prettier、至少 1 条单测或 Story、更新 README.vibe.md / sample.http / PROGRESS.md。

## 5. 协作规范

- **Git 流程**：从 `main` 切 `feature/<任务号>` 分支并 `git worktree add ../p2p-<任务号> feature/<任务号>`，所有开发在新 worktree 进行；提交前运行 lint/test。
- **配置与环境**：`.env` 管理各服务基址；服务均为 FastAPI + SQLite（可替换 Postgres）。启动方式 `python3 -m venv .venv && source .venv/bin/activate && uvicorn ...`。
- **接口契约**：`接口草案.yaml` 同步更新；`services/api` 统一封装请求；mock 数据放 `apps/<项目>/src/mocks` 并在 README 说明。
- **文档同步**：交付完成后更新 `PROGRESS.md`、`临时文件`（调试记录）、各服务 `README` / `README.vibe.md` / `sample.http`。
- **验证方式**：默认使用 curl；必要时补充 pytest / vitest / Playwright。

## 6. 当前状态与下一步

- **已完成**：T1~T15、T19-M1/M2；SQLite 已落地 loan/payment/ledger/collection；admin-web 登录/RBAC、Dashboard、Daily Stats 已以 React Query 打底并提供导出 API。
- **短期优先级**
  1. bff-admin `/admin/v1/auth/*` 实现并替换 admin-web mock。
  2. Admin Web M3（申请列表/导出、审批详情）。
  3. report-svc 与 channel-svc 数据对齐，确保日报/漏斗口径验证。
- **风险与 TODO**
  - SQLite 需迁移至 Postgres/Redis；ledger/collection 缺查询接口。
  - 通知/ops/p2p 仍在规划阶段，需要明确数据模型与权限。
  - 前端仍缺完整测试与 Story，需在 M3+ 补齐。

> 本文件作为统一的“整体开发计划”，随里程碑推进更新版本号，便于前后端/BFF/运营对齐节奏。
