# 开放问题与假设

## 1. 业务层面

### 1.1 市场与合规

| 问题 | 假设 | 风险 | 建议确认顺序 | 备选方案 |
|------|------|------|--------------|----------|
| 目标市场是否确定？ | 假设：加纳（主）+ 尼日利亚（备），币种GHS/NGN/USD | 高 - 影响支付通道、合规要求 | **P0（立即）** | 方案A：先单一市场；方案B：预留多市场架构 |
| 是否已获得金融牌照？ | 假设：已获得或与持牌机构合作 | 高 - 影响业务合法性 | **P0（立即）** | 方案A：自有牌照；方案B：与持牌机构联合运营 |
| 利率/费率是否符合当地法规？ | 假设：APR 36%-365%符合当地法规 | 高 - 影响产品设计 | **P0（立即）** | 方案A：律师审核；方案B：参考本地竞品 |
| 数据隐私合规要求？ | 假设：参考GDPR标准（数据脱敏/保留期/删除权） | 中 - 影响技术实现 | **P1（1周内）** | 方案A：严格GDPR；方案B：本地法规最低要求 |

### 1.2 产品定义

| 问题 | 假设 | 风险 | 建议确认顺序 | 备选方案 |
|------|------|------|--------------|----------|
| 贷款期限档位？ | 假设：7/14/28天（高频小额） | 低 - 可配置调整 | **P2（2周内）** | 方案A：超短期（7天）；方案B：中期（90/180天） |
| 首贷额度范围？ | 假设：100-5000 GHS | 低 - 可配置调整 | **P2（2周内）** | 方案A：更小额度（50-1000）；方案B：更大额度（5000-20000） |
| 展期策略？ | 假设：允许展期≤3次，每次收取展期费 | 中 - 影响还款体验与风控 | **P2（2周内）** | 方案A：不允许展期；方案B：无限次展期 |
| 复借策略？ | 假设：结清后+冷却期（0-7天）可复借，额度/费率优化 | 低 - 影响复借率 | **P3（4周内）** | 方案A：立即复借；方案B：必须冷却期 |
| 是否支持部分还款？ | 假设：支持部分还款，按本金→利息→费用顺序冲抵 | 中 - 影响账务复杂度 | **P2（2周内）** | 方案A：仅支持全额还款；方案B：支持部分还款 |

### 1.3 风控策略

| 问题 | 假设 | 风险 | 建议确认顺序 | 备选方案 |
|------|------|------|--------------|----------|
| 机审通过率目标？ | 假设：首贷20%-30%，复借50%-60% | 中 - 影响规则配置 | **P2（2周内）** | 方案A：更严格（10%）；方案B：更宽松（50%） |
| 人工审核比例？ | 假设：机审通过可跳过人审，灰度区域进入人审（10%-20%） | 低 - 可动态调整 | **P3（4周内）** | 方案A：全部人审；方案B：全自动 |
| 黑名单来源？ | 假设：自建黑名单 + 第三方黑名单（如同盾，可选） | 中 - 影响接口设计 | **P2（2周内）** | 方案A：仅自建；方案B：对接第三方 |
| 等级策略？ | 假设：Level1-5，首贷Level1，复借提升，逾期降级 | 低 - 可配置调整 | **P3（4周内）** | 方案A：固定等级；方案B：动态调整 |

---

## 2. 技术层面

### 2.1 架构与选型

| 问题 | 假设 | 风险 | 建议确认顺序 | 备选方案 |
|------|------|------|--------------|----------|
| 团队技术栈熟悉度？ | 假设：熟悉TypeScript/NestJS | 高 - 影响开发效率 | **P0（立即）** | 方案A：NestJS；方案B：Spring Boot（Java）；方案C：Django（Python） |
| Monorepo vs Multi-repo？ | 假设：使用Monorepo（pnpm workspace） | 中 - 影响代码组织 | **P1（1周内）** | 方案A：Monorepo（便于共享代码）；方案B：Multi-repo（服务独立） |
| 事件总线：Kafka vs RabbitMQ？ | 假设：使用Kafka（高吞吐） | 中 - 影响事件架构 | **P1（1周内）** | 方案A：Kafka；方案B：RabbitMQ（更轻量）；方案C：Redis Streams |
| 数据库：单库 vs 分库？ | 假设：首期单PostgreSQL库，预留分库能力 | 中 - 影响扩展性 | **P2（2周内）** | 方案A：单库（简单）；方案B：按服务分库（解耦） |
| OLAP：ClickHouse vs PostgreSQL？ | 假设：首期用PostgreSQL物化视图，二期迁移ClickHouse | 低 - 影响报表性能 | **P3（4周内）** | 方案A：直接ClickHouse；方案B：先PostgreSQL过渡 |

### 2.2 集成与第三方

| 问题 | 假设 | 风险 | 建议确认顺序 | 备选方案 |
|------|------|------|--------------|----------|
| OCR服务商？ | 假设：首期用Mock，预留接口切换真实服务（AnyVision/百度/腾讯云） | 高 - 影响KYC准确率 | **P1（1周内）** | 方案A：百度OCR；方案B：AWS Textract；方案C：自建模型 |
| 活体检测服务商？ | 假设：首期用Mock，预留接口切换真实服务（Face++/腾讯云） | 高 - 影响KYC安全性 | **P1（1周内）** | 方案A：Face++；方案B：阿里云实人认证；方案C：自建模型 |
| 支付通道？ | 假设：首期沙箱（XPay/MTN Mobile Money），二期切换真实通道 | 高 - 影响放款/还款 | **P1（1周内）** | 方案A：Flutterwave；方案B：Paystack；方案C：MTN/Vodafone直连 |
| 短信服务商？ | 假设：首期用Mock，预留接口切换（Twilio/阿里云） | 中 - 影响通知触达率 | **P2（2周内）** | 方案A：Twilio；方案B：阿里云；方案C：本地运营商 |
| Kochava归因？ | 假设：首期用本地模拟数据，预留Kochava API接口 | 中 - 影响渠道归因准确性 | **P2（2周内）** | 方案A：Kochava；方案B：Adjust；方案C：AppsFlyer；方案D：自建归因 |

### 2.3 部署与运维

| 问题 | 假设 | 风险 | 建议确认顺序 | 备选方案 |
|------|------|------|--------------|----------|
| 云服务商？ | 假设：AWS/阿里云/腾讯云（需确认） | 高 - 影响成本与合规 | **P0（立即）** | 方案A：AWS；方案B：阿里云；方案C：自建IDC |
| K8s集群是否已准备？ | 假设：有DevOps支持，K8s集群已准备 | 高 - 影响部署方式 | **P0（立即）** | 方案A：K8s；方案B：Docker Swarm；方案C：虚拟机部署 |
| 数据库备份策略？ | 假设：主从复制 + 日备 + 3年保留 | 中 - 影响数据安全 | **P1（1周内）** | 方案A：主从 + 日备；方案B：主从 + 增量备份；方案C：云RDS托管 |
| 灰度发布方式？ | 假设：按用户ID尾号灰度（1%-5%-20%-100%） | 低 - 影响发布流程 | **P3（4周内）** | 方案A：用户ID灰度；方案B：地理位置灰度；方案C：金丝雀部署 |

---

## 3. 数据与指标

### 3.1 数据量预估

| 问题 | 假设 | 风险 | 建议确认顺序 | 备选方案 |
|------|------|------|--------------|----------|
| 首年用户量？ | 假设：10万用户/年 | 中 - 影响性能规划 | **P2（2周内）** | 方案A：1万（小规模）；方案B：10万；方案C：100万（大规模） |
| 首年订单量？ | 假设：50万笔/年（平均每用户5笔） | 中 - 影响数据库设计 | **P2（2周内）** | 方案A：10万笔；方案B：50万笔；方案C：500万笔 |
| 峰值QPS？ | 假设：QPS 500（按10万用户同时在线1%估算） | 中 - 影响性能测试目标 | **P2（2周内）** | 方案A：QPS 100；方案B：QPS 500；方案C：QPS 5000 |

### 3.2 指标定义

| 问题 | 假设 | 风险 | 建议确认顺序 | 备选方案 |
|------|------|------|--------------|----------|
| 首逾率计算口径？ | 假设：D0首逾率 = 当日到期未还笔数 / 当日到期应还笔数 | 低 - 影响报表准确性 | **P2（2周内）** | 方案A：D0口径；方案B：D1口径；方案C：D7口径 |
| 复借率计算口径？ | 假设：复借率 = 有过一次结清后再次借款的用户数 / 结清用户数 | 低 - 影响报表准确性 | **P3（4周内）** | 方案A：按用户数；方案B：按订单数 |
| 逾期迁移率计算？ | 假设：D0→D1→D3→D7→D15→D30→D60→D90 | 低 - 影响报表准确性 | **P3（4周内）** | 方案A：按桶迁移；方案B：按天连续迁移 |

---

## 4. 用户体验

### 4.1 App体验

| 问题 | 假设 | 风险 | 建议确认顺序 | 备选方案 |
|------|------|------|--------------|----------|
| 是否需要原生功能？ | 假设：使用Flutter（跨平台），足够满足需求 | 中 - 影响开发周期 | **P1（1周内）** | 方案A：Flutter；方案B：React Native；方案C：原生开发 |
| 是否需要离线功能？ | 假设：不需要离线，所有数据云端同步 | 低 - 影响开发复杂度 | **P3（4周内）** | 方案A：纯在线；方案B：部分离线缓存 |
| 是否需要生物识别登录？ | 假设：暂不支持，仅OTP登录 | 低 - 影响用户体验 | **P3（4周内）** | 方案A：仅OTP；方案B：OTP + Face ID/Touch ID |

### 4.2 后台体验

| 问题 | 假设 | 风险 | 建议确认顺序 | 备选方案 |
|------|------|------|--------------|----------|
| 是否需要移动端后台？ | 假设：仅PC Web后台，暂不需要移动端 | 低 - 影响运营效率 | **P3（4周内）** | 方案A：仅PC；方案B：响应式（兼容移动端）；方案C：独立移动端 |
| 是否需要多语言后台？ | 假设：后台仅英文 | 低 - 影响国际化 | **P3（4周内）** | 方案A：仅英文；方案B：英文+中文 |

---

## 5. 安全与合规

### 5.1 数据安全

| 问题 | 假设 | 风险 | 建议确认顺序 | 备选方案 |
|------|------|------|--------------|----------|
| 敏感数据加密方式？ | 假设：AES-256-GCM加密（身份证号/银行账号），密钥存KMS | 高 - 影响数据安全 | **P0（立即）** | 方案A：KMS托管；方案B：自建密钥管理；方案C：硬件加密 |
| 数据保留期？ | 假设：用户数据保留3年，审计日志保留5年 | 中 - 影响存储成本 | **P1（1周内）** | 方案A：3年；方案B：7年；方案C：永久保留 |
| 数据删除策略？ | 假设：用户注销后30天软删除，1年后物理删除 | 中 - 影响合规性 | **P2（2周内）** | 方案A：立即删除；方案B：延迟删除；方案C：匿名化保留 |

### 5.2 权限控制

| 问题 | 假设 | 风险 | 建议确认顺序 | 备选方案 |
|------|------|------|--------------|----------|
| RBAC粒度？ | 假设：菜单级 + 按钮级 + 数据行级（如"仅看本人案件"） | 中 - 影响权限复杂度 | **P2（2周内）** | 方案A：仅菜单级；方案B：菜单+按钮；方案C：菜单+按钮+数据行 |
| 是否需要2FA？ | 假设：后台管理员需要2FA（OTP/Google Authenticator） | 中 - 影响安全性 | **P2（2周内）** | 方案A：不需要；方案B：管理员2FA；方案C：全员2FA |
| 是否需要IP白名单？ | 假设：生产环境后台需要IP白名单 | 中 - 影响运维灵活性 | **P2（2周内）** | 方案A：不需要；方案B：IP白名单；方案C：VPN访问 |

---

## 6. 成本与资源

### 6.1 基础设施成本

| 问题 | 假设 | 风险 | 建议确认顺序 | 备选方案 |
|------|------|------|--------------|----------|
| 首年基础设施预算？ | 假设：$50,000-$100,000/年（云服务+带宽+存储+第三方API） | 高 - 影响技术选型 | **P0（立即）** | 方案A：低预算（$20k）；方案B：中预算（$50k）；方案C：高预算（$100k+） |
| 支付通道费率？ | 假设：放款手续费2%-5%，还款手续费1%-3% | 中 - 影响费用设计 | **P1（1周内）** | 方案A：低费率通道；方案B：混合多通道降低成本 |
| 三方服务费用？ | 假设：OCR $0.01/次，活体$0.05/次，短信$0.02/条 | 中 - 影响运营成本 | **P1（1周内）** | 方案A：按量付费；方案B：包年套餐 |

### 6.2 人力资源

| 问题 | 假设 | 风险 | 建议确认顺序 | 备选方案 |
|------|------|------|--------------|----------|
| 团队规模？ | 假设：2-3后端 + 1-2前端 + 1测试/DevOps | 高 - 影响工期 | **P0（立即）** | 方案A：5人团队（18周）；方案B：8人团队（12周）；方案C：外包部分模块 |
| 是否有DevOps支持？ | 假设：有专职DevOps | 中 - 影响基础设施搭建 | **P0（立即）** | 方案A：有DevOps；方案B：后端兼职DevOps；方案C：托管服务（如AWS ECS） |
| 是否有UI/UX设计？ | 假设：有设计师提供UI原型 | 中 - 影响前端开发效率 | **P1（1周内）** | 方案A：有设计师；方案B：使用Ant Design/Material默认风格 |

---

## 7. 明确冲突点

### 7.1 产品需求文档与开发计划的差异

| 冲突点 | PRD描述 | 开发计划描述 | 建议 |
|--------|---------|--------------|------|
| P2P模块时机 | PRD提到"P2P出借撮合为可选模块（二期）" | 开发计划将P2P放在Phase 3（6-8周） | **建议**：明确P2P是否为MVP范围外，若是则延后；若必须，则调整工期至Phase 2 |
| 电销模块范围 | PRD详细描述电销管理（线索/任务/拨打/外呼号码） | 开发计划将电销列为"可选二期" | **建议**：确认电销是否MVP必须，若是则需增加Epic（电销域） |
| 外呼机器人 | PRD提到"催收语音配置/外呼机器人" | 开发计划将外呼机器人列为Phase 2 | **建议**：确认外呼机器人是否MVP必须，若是则需提前集成 |
| 对账模块复杂度 | PRD提到"对账文件解析（基础版）" | 开发计划仅有简单对账（F-3），未详细拆解 | **建议**：明确对账要求（日对账/实时对账/差异处理），若复杂则需增加任务 |

### 7.2 技术实现的模糊点

| 模糊点 | 描述 | 建议 |
|--------|------|------|
| 合同电子签名方式 | PRD提到"手写签名/勾选+验证码"，但未明确电子签名法律效力 | **建议**：确认本地电子签名法规，是否需要对接第三方电子签平台（如DocuSign） |
| 展期补充协议 | PRD提到"签署展期补充协议"，但未明确是否需要生成新PDF | **建议**：确认展期是否需要新合同，还是仅更新原合同附件 |
| 部分还款冲抵顺序 | PRD提到"部分还款"，但未明确冲抵顺序（本金优先 vs 利息优先） | **建议**：明确冲抵顺序：本金→利息→费用→逾期费（符合监管要求） |
| 逾期费计算方式 | PRD提到"逾期费=逾期本金*日逾期费率*逾期天数（上限可配）"，但未明确上限规则 | **建议**：明确逾期费上限（如不超过本金30%），并配置化 |

---

## 8. 决策树与优先级

### 8.1 决策优先级（P0 → P1 → P2 → P3）

**P0（立即确认，阻塞开发）**
1. 目标市场与币种
2. 金融牌照与合规
3. 云服务商与K8s集群
4. 敏感数据加密方式
5. 团队规模与技术栈熟悉度

**P1（1周内确认，影响架构设计）**
1. OCR/活体/支付通道服务商
2. Monorepo vs Multi-repo
3. 事件总线选型（Kafka vs RabbitMQ）
4. 数据保留期与备份策略
5. 支付通道费率与三方服务费用

**P2（2周内确认，影响功能范围）**
1. 贷款期限档位与首贷额度
2. 展期与复借策略
3. 机审通过率目标与人工审核比例
4. 数据库分库策略
5. RBAC粒度与2FA需求

**P3（4周内确认，影响体验优化）**
1. 复借率与逾期迁移率计算口径
2. 灰度发布方式
3. 是否需要生物识别登录
4. 是否需要移动端后台
5. OLAP升级时机（ClickHouse）

### 8.2 决策流程建议

```
Step 1: 业务决策会议（与产品/运营/法务/财务）
  ↓ 确认 P0 问题（市场/合规/预算）
  
Step 2: 技术选型评审（与技术团队）
  ↓ 确认 P1 问题（架构/服务商/成本）
  
Step 3: 需求细化工作坊（与产品/开发/测试）
  ↓ 确认 P2 问题（功能范围/策略/指标）
  
Step 4: 迭代优化（开发过程中）
  ↓ 确认 P3 问题（体验/性能/扩展性）
```

---

## 9. 风险缓解措施

| 风险 | 缓解措施 | 责任人 | 检查点 |
|------|----------|--------|--------|
| 三方服务（OCR/活体/支付）不稳定 | - 使用Mock stub开发<br>- 预留接口切换能力<br>- 降级策略（人工兜底） | 技术负责人 | Sprint 2/4/5 |
| 需求频繁变更 | - 每Sprint冻结需求<br>- 变更需走评审流程<br>- 预留20%Buffer时间 | 产品经理 | 每Sprint开始前 |
| 团队能力不足 | - 技术培训（NestJS/Flutter）<br>- 代码Review机制<br>- 结对编程（关键模块） | 技术负责人 | Sprint 0/1 |
| 性能不达标 | - 提前压测（Sprint 5后）<br>- 数据库索引优化<br>- 缓存策略<br>- 读写分离 | 后端负责人 | Sprint 8 |
| 安全漏洞 | - 安全编码培训<br>- 每Sprint安全评审<br>- 上线前渗透测试<br>- Bug Bounty | 安全专家 | Sprint 8 |
| 工期延误 | - 关键路径监控<br>- 每周进度同步<br>- 阻塞问题升级机制<br>- 备用方案（削减非核心功能） | 项目经理 | 每周五 |

---

## 10. 决策记录模板

**建议**：每次决策后填写以下记录，纳入项目文档

```markdown
## 决策记录 #001

**日期**：2025-01-XX  
**决策者**：[姓名/角色]  
**问题**：[待决策问题]  
**选项**：
- 方案A：[描述]
- 方案B：[描述]

**决策**：选择方案X  
**理由**：[1-2句话说明原因]  
**影响范围**：[影响哪些模块/任务]  
**后续行动**：[需要更新哪些文档/代码]  
**复审日期**：[可选，如需后续验证效果]
```

---

## 11. 假设汇总清单

为便于检索，所有假设汇总如下（按优先级排序）：

### P0（立即确认）
1. ✅ 目标市场：加纳（主）+ 尼日利亚（备），币种GHS/NGN/USD
2. ✅ 金融牌照：已获得或与持牌机构合作
3. ✅ 云服务商：AWS/阿里云/腾讯云（需确认）
4. ✅ K8s集群：有DevOps支持，集群已准备
5. ✅ 敏感数据加密：AES-256-GCM + KMS
6. ✅ 团队规模：2-3后端 + 1-2前端 + 1测试/DevOps
7. ✅ 技术栈：TypeScript/NestJS

### P1（1周内确认）
8. ✅ OCR服务：首期Mock，预留接口（百度/AWS Textract）
9. ✅ 活体检测：首期Mock，预留接口（Face++/阿里云）
10. ✅ 支付通道：首期沙箱，预留接口（Flutterwave/Paystack）
11. ✅ Monorepo：使用pnpm workspace
12. ✅ 事件总线：Kafka（高吞吐）
13. ✅ 数据保留期：3年（用户数据）、5年（审计日志）
14. ✅ APR范围：36%-365%（符合本地法规，需律师确认）

### P2（2周内确认）
15. ✅ 贷款期限：7/14/28天（高频小额）
16. ✅ 首贷额度：100-5000 GHS
17. ✅ 展期策略：允许≤3次，收取展期费
18. ✅ 部分还款：支持，冲抵顺序：本金→利息→费用
19. ✅ 机审通过率：首贷20%-30%，复借50%-60%
20. ✅ 人工审核：机审通过跳过，灰度区域进入（10%-20%）
21. ✅ 数据库：首期单PostgreSQL库，预留分库能力
22. ✅ RBAC：菜单级 + 按钮级 + 数据行级
23. ✅ 2FA：后台管理员需要

### P3（4周内确认）
24. ✅ 复借策略：结清后+冷却期（0-7天）可复借
25. ✅ 等级策略：Level1-5，首贷L1，复借提升，逾期降级
26. ✅ 首逾率口径：D0首逾率 = 当日到期未还 / 当日到期应还
27. ✅ OLAP：首期PostgreSQL物化视图，二期ClickHouse
28. ✅ 灰度发布：按用户ID尾号（1%-5%-20%-100%）
29. ✅ 生物识别：暂不支持，仅OTP登录
30. ✅ 移动端后台：仅PC Web，暂不需要

---

**文档版本**：v1.0  
**创建日期**：2025-01-07  
**负责人**：架构师团队  
**更新频率**：每次决策后更新  
**下次复审**：Sprint 0结束前（完成P0/P1确认）

