| ID | 任务名 | 目标摘要 | 输入依赖 | 主要改动 | 对外接口 | 测试点 | DoD | 自检清单 | 产物路径 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| T1 | OTP 请求接口 | 提供 `POST /auth/otp` 生成并限流 OTP | PRD 登录流；假设A5 | 新增 OTPController、service、Redis 限流脚本 | `POST /auth/otp` | 单测覆盖速率限制、到期时间 | 单测+Swagger 更新+本地 curl 成功 | 1) curl 触发 200；2) Redis key 自动失效；3) 日志脱敏 | services/auth-svc/src/modules/otp |
| T2 | OTP 校验与 JWT 发放 | 核发 Borrower JWT/Refresh Token | T1；PRD token 结构 | 添加 TokenService、JWT 签名配置、E2E 测试 | `POST /auth/token` | 成功/失败 OTP 测试、JWT 过期时间 | 单测、黑盒测试、Swagger | 1) 错误 OTP 返回 401；2) JWT 含 userId 作用域；3) Refresh 可换新 | services/auth-svc/src/modules/token |
| T3 | 设备指纹写入 | 保存设备指纹与授权状态 | 假设A4；PRD 授权要求 | user-svc 增加 Device entity、API DTO | `PUT /users/{id}/device` (BFF 内部) | 多次写入去重；授权标记 | 单测+API 文档+migration | 1) 相同指纹不重复；2) 审计日志记录; 3) Decimal 字段保持 18,4 | services/user-svc/src/modules/device |
| T4 | KYC 元数据接口 | 上传 OCR/活体结果并触发审核 | T3；PRD KYC 流程 | user-svc 增加 KycController、状态机、S3 上传 stub | `PUT /users/{id}/kyc` | 状态迁移 PENDING→REVIEWING | 单测、S3 stub、Swagger | 1) 必填字段校验；2) 事件 `KYC_SUBMITTED`; 3) 文件 URI 加签 | services/user-svc/src/modules/kyc |
| T5 | 风控评估 Stub | risk-svc 接收请求并返回决策 | T4；假设A6 | RiskEvaluationController、规则脚本样例、Kafka 事件 | `POST /risk/evaluations` | 命中规则与默认通过两种 case | 单测、事件发布、Swagger | 1) 输入 hash 去抖；2) Kafka 推送 `RISK_DECIDED`; 3) 延迟 <100ms | services/risk-svc/src/modules/evaluation |
| T6 | 产品配置查询 | 返回 loan product/费率表 | 产品计划 §3；A2 | loan-svc 新建 ProductService，缓存配置 | `GET /loan/products` (BFF 内) | 金额/期限越界报错 | 单测、Swagger、样例配置 | 1) Decimal 精度校验；2) 配置热加载；3) RBAC 生效 | services/loan-svc/src/modules/products |
| T7 | 贷款申请提交 | 完成 `POST /loans` + `/loans/{id}/submit` | T5, T6 | loan-svc Controller、Application aggregate、status 迁移 | `POST /loans`, `POST /loans/{id}/submit` | 幂等键重复检测；事件发布 | 单测、集成（借款人→风控） | 1) `LOAN_APPLIED` 事件; 2) 状态正确；3) Swagger | services/loan-svc/src/modules/applications |
| T8 | 合同快照 Stub | 生成合同 JSON→PDF URI | T7；假设A4 | 新增 ContractService、模板、S3 stub | `GET /loans/{id}/contracts` | 模板变量正确、签署状态 | 单测、样例 PDF、Swagger | 1) 模板字段覆盖；2) URL 有效 15 分钟；3) 审计记录 | services/loan-svc/src/modules/contracts |
| T9 | 放款指令与回调 | payment-svc 对接聚合器，处理回调 | T7,T8；假设A3 | DisbursementController、ChannelAdapter、callback | `POST /payments/disbursements`, `/callbacks/{channel}` | 通道成功/失败 case | 单测+回调 mock+Swagger | 1) req/res 日志脱敏；2) 幂等处理；3) 发布 `DISBURSED` | services/payment-svc/src/modules/disbursement |
| T10 | 放款记账 | ledger-svc 写入 double-entry | T9; ledger 设计 | LedgerController、balance 校验、unit test | `POST /ledger/entries` | 借贷平衡断言 | 单测+Swagger+lint | 1) 平衡校验必过；2) Redis 幂等锁；3) metrics 暴露 | services/ledger-svc/src/modules/entries |
| T11 | 还款登记 & 账单刷新 | 支持主动还款 | T9,T10 | payment-svc repayment API、loan-svc schedule 更新 | `POST /payments/repayments` | 多次回调幂等、账单扣减 | 单测、集成测试 | 1) `REPAYMENT_POSTED` 事件；2) 账单 Decimal 正确；3) 催收解除 | services/payment-svc/src/modules/repayment |
| T12 | 催收建案与分案 | collection-svc 接收逾期事件建案 | T11 | CaseService、assignment 规则、workbench API | `POST /collections/cases`, `/cases/{id}/actions` | PTP 记录与状态变化 | 单测、事件模拟、Swagger | 1) Case 状态机合法；2) RBAC 鉴权；3) 审计日志 | services/collection-svc/src/modules/cases |
| T13 | 通知模板触达 | notify-svc 聚合短信/WhatsApp | T9,T11,T12 | Template engine、channel adapter stub、API | `POST /notifications/send` | 并发 50rps；重试策略 | 单测、channel mock、Swagger | 1) 幂等 key 生效；2) 模板变量校验；3) 告警值守 | services/notify-svc/src/modules/send |
| T14 | 平台每日统计 | report-svc 聚合指标并提供查询 | T11,T12,T13；假设A6 | ETL job (Kafka→ClickHouse/Postgres MV) + API | `GET /reports/daily` | 指标一致性 vs 原始数据 | 单测、对账脚本、Swagger | 1) 当日指标对比抽样 ≤0.5% 偏差；2) job 失败告警；3) API 200ms 内 | services/report-svc/src/modules/daily |
