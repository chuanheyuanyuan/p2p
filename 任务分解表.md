| ID | 任务名 | 目标摘要 | 输入依赖 | 主要改动 | 对外接口 | 测试点 | DoD | 自检清单 | 产物路径 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| T1 | OTP 请求接口 | 提供 `POST /auth/otp` 生成并限流 OTP | PRD 登录流；假设A5 | 新增 OTPController、service、Redis 限流脚本 | `POST /auth/otp` | 单测覆盖速率限制、到期时间 | 单测+Swagger 更新+本地 curl 成功 | 1) curl 触发 200；2) Redis key 自动失效；3) 日志脱敏 | services/auth-svc/src/modules/otp |
| T2 | OTP 校验与 JWT 发放 | 核发 Borrower JWT/Refresh Token | T1；PRD token 结构 | 添加 TokenService、JWT 签名配置、E2E 测试 | `POST /auth/token` | 成功/失败 OTP 测试、JWT 过期时间 | 单测、黑盒测试、Swagger | 1) 错误 OTP 返回 401；2) JWT 含 userId 作用域；3) Refresh 可换新 | services/auth-svc/src/modules/token |
| T3 | 设备指纹写入 | 保存设备指纹与授权状态 | 假设A4；PRD 授权要求 | user-svc 增加 Device entity、API DTO | `PUT /users/{id}/device` (BFF 内部) | 多次写入去重；授权标记 | 单测+API 文档+migration | 1) 相同指纹不重复；2) 审计日志记录; 3) Decimal 字段保持 18,4 | services/user-svc/src/modules/device |
| T4 | KYC 元数据接口 | 上传 OCR/活体结果并触发审核 | T3；PRD KYC 流程 | user-svc 增加 KycController、状态机、S3 上传 stub | `PUT /users/{id}/kyc` | 状态迁移 PENDING→REVIEWING | 单测、S3 stub、Swagger | 1) 必填字段校验；2) 事件 `KYC_SUBMITTED`; 3) 文件 URI 加签 | services/user-svc/src/modules/kyc |
| T5 | 风控评估 Stub | risk-svc 接收请求并返回决策 | T4；假设A6 | RiskEvaluationController、规则脚本样例、Kafka 事件 | `POST /risk/evaluations` | 命中规则与默认通过两种 case | 单测、事件发布、Swagger | 1) 输入 hash 去抖；2) Kafka 推送 `RISK_DECIDED`; 3) 延迟 <100ms | services/risk-svc/src/modules/evaluation |
| T6 | 产品配置查询 | 返回 loan product/费率表 | 产品计划 §3；A2 | loan-svc 新建 ProductService，缓存配置 | `GET /loan/products` (BFF 内) | 金额/期限越界报错 | 单测、Swagger、样例配置 | 1) Decimal 精度校验；2) 配置热加载；3) RBAC 生效 | services/loan-svc/src/modules/products |
| T7 | 贷款申请提交 | 完成 `POST /loans` + `/loans/{id}/submit` | T5, T6 | loan-svc Controller、Application aggregate、status 迁移 | `POST /loans`, `POST /loans/{id}/submit` | 幂等键重复检测；事件发布 | 单测、集成（借款人→风控） | 1) `LOAN_APPLIED` 事件; 2) 状态正确；3) Swagger | services/loan-svc/src/modules/applications |
| T8 | 合同快照 Stub | 生成合同 JSON→PDF URI | T7；假设A4 | 新增 ContractService、模板、S3 stub | `GET /loans/{id}/contracts` | 模板变量正确、签署状态 | 单测、样例 PDF、Swagger | 1) 模板字段覆盖；2) URL 有效 15 分钟；3) 审计记录 | services/loan-svc/src/modules/contracts |
| T9 | 放款指令与回调 | payment-svc 对接聚合器，处理回调 | T7,T8；假设A3 | DisbursementController、ChannelAdapter、callback | `POST /payments/disbursements`, `/callbacks/{channel}` | 通道成功/失败 case | 单测+回调 mock+Swagger | 1) req/res 日志脱敏；2) 幂等处理；3) 发布 `DISBURSED` | services/payment-svc/src/modules/disbursement |
| T10 | 放款记账 | ledger-svc 写入 double-entry | T9; ledger 设计 | LedgerController、balance 校验、unit test | `POST /ledger/entries` | 借贷平衡断言 | 单测+Swagger+lint | 1) 平衡校验必过；2) Redis 幂等锁；3) metrics 暴露 | services/ledger-svc/src/modules/entries |
| T11 | 还款登记 & 账单刷新 | 支持主动还款 | T9,T10 | payment-svc repayment API、loan-svc schedule 更新 | `POST /payments/repayments` | 多次回调幂等、账单扣减 | 单测、集成测试 | 1) `REPAYMENT_POSTED` 事件；2) 账单 Decimal 正确；3) 催收解除 | services/payment-svc/src/modules/repayment |
| T12 | 催收建案与分案 | collection-svc 接收逾期事件建案 | T11 | CaseService、assignment 规则、workbench API | `POST /collections/cases`, `/cases/{id}/actions` | PTP 记录与状态变化 | 单测、事件模拟、Swagger | 1) Case 状态机合法；2) RBAC 鉴权；3) 审计日志 | services/collection-svc/src/modules/cases |
| T13 | 通知模板触达 | notify-svc 聚合短信/WhatsApp | T9,T11,T12 | Template engine、channel adapter stub、API | `POST /notifications/send` | 并发 50rps；重试策略 | 单测、channel mock、Swagger | 1) 幂等 key 生效；2) 模板变量校验；3) 告警值守 | services/notify-svc/src/modules/send |
| T14 | 平台每日统计 | report-svc 聚合指标并提供查询 | T11,T12,T13；假设A6 | ETL job (Kafka→ClickHouse/Postgres MV) + API | `GET /reports/daily` | 指标一致性 vs 原始数据 | 单测、对账脚本、Swagger | 1) 当日指标对比抽样 ≤0.5% 偏差；2) job 失败告警；3) API 200ms 内 | services/report-svc/src/modules/daily |
| T15 | 渠道归因与漏斗 | channel-svc 接收 Kochava/渠道上报，输出漏斗 | PRD 渠道域；T14 数据活跃 | 新建 channel-svc：归因表、漏斗 API、Kochava webhook | `POST /channels/attributions`, `GET /channels/funnel` | 归因幂等、渠道统计准确性 | 单测、Webhook 回放、Swagger | 1) 归因成功率≥99%；2) 重复上报幂等；3) API P95<200ms | services/channel-svc/src |
| T16 | 运营配置服务 | ops-svc 管理产品/用户等级/审批策略 | T6、蓝图运营域 | 新建 ops-svc，含产品、等级、策略 CRUD + 审批流 | `/ops/products`, `/ops/grades`, `/ops/rules` | RBAC、发布审批、配置版本回滚 | 单测+集成+Swagger | 1) 配置带版本号；2) 变更记录审计；3) 热加载成功 | services/ops-svc/src |
| T17 | BFF-Mobile 聚合层 | 提供面向 App 的聚合 API | 依赖 user/auth/loan/payment | FastAPI BFF，封装注册、申请、账单等组合接口 | `/mobile/v1/dashboard`, `/mobile/v1/loans` | 与后端契约一致、缓存策略 | 单测、契约测试、Postman | 1) BFF 200/401 行为正确；2) SLA 记录；3) 日志脱敏 | services/bff-mobile |
| T18 | BFF-Admin 聚合层 | 提供后台审批/催收/报表接口 | 依赖 loan/payment/collection/report | FastAPI BFF，注入 Casbin 权限，聚合表格数据 | `/admin/v1/applications`, `/admin/v1/collections` | 权限校验、分页性能 | 集成测试、Swagger | 1) 权限覆盖菜单；2) 查询分页可控；3) Trace 注入 | services/bff-admin |
| T19 | Admin Web 前端 | React + AntD 管理后台 | T17,T18 接口定义 | Vite/React 工程：导航、申请、催收、报表、运营配置 | 调用 BFF API | E2E（Playwright）、Lighthouse、单元测试 | 页面渲染、接口联通、CI 构建 | apps/admin-web |
| T20 | 观测与审计服务 | 统一日志、追踪、审计落库 | 全链路 | 部署 OTel Collector、审计日志服务、Grafana Dashboard | `/audit/events` | 日志完整性、审计查询 | 日志抽样校验、告警演练 | 1) Trace 覆盖核心链路；2) 审计可追溯；3) 告警配置完成 | infra/observability |
